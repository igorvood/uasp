package ru.vtb.uasp.inputconvertor.utils.kafka

import org.scalatest.flatspec.AnyFlatSpec
import org.scalatest.matchers.should

class KafkaUtilsTest extends AnyFlatSpec with should.Matchers {
  //  Comment because is needed kafka connection
  //  "The schema from kafka topic" should "be equals corresponding schema " in {
  //    val standardJsonSchema = """{"$schema":"http://json-schema.org/draft-07/schema#","title":"IssuingOperation","type":"object","additionalProperties":true,"description":"issuingoperation:on/offus*auth/fin","properties":{"id":{"type":"string","description":"Uniquewithinprocessingcenter,actiontype"},"prevId":{"type":"string","description":"Referencetoprevious"},"chain":{"$ref":"#/definitions/OperationChain"},"actionType":{"type":"string","enum":["Authorization","AuthorizationReversal","AuthorizationAdjustment","Presentment","PresentmentReversal","PresentmentAdjustment","Chargeback","ChargebackPartial","ChargebackReversal","ChargebackAdjustment","Representment","RepresentmentPartial","RepresentmentReversal","Acknowledgement","WriteOff"],"description":"Chainstepofbusinessservice(definedbyservicetype)"},"comment":{"type":"string"},"reasonDetails":{"type":"string"},"card":{"$ref":"#/definitions/IssuingCardRef"},"account":{"$ref":"#/definitions/IssuingAccountRef"},"requestedAmount":{"$ref":"#/definitions/OperationAmount"},"routing":{"oneOf":[{"$ref":"#/definitions/IncomingRouting"},{"$ref":"#/definitions/OutgoingRouting"},{"$ref":"#/definitions/OnUsRouting"},{"$ref":"#/definitions/InternalRouting"}]},"pointOfService":{"$ref":"#/definitions/PointOfService"},"processing":{"$ref":"#/definitions/IssuingOperationProcessing"},"paymentDetails":{"$ref":"#/definitions/PaymentDetails","description":"Paymentattributes"},"counterpartyPaymentDetails":{"$ref":"#/definitions/PaymentDetails","description":"Counterpartypaymentattributes"},"taggedData":{"type":"object","additionalProperties":{"type":"string"}},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["id","chain","actionType","account","requestedAmount","routing","processing","taggedData"],"definitions":{"OperationChain":{"type":"object","additionalProperties":true,"description":"operationchaindescription(relatedtotheoriginaloperationinchain)","properties":{"id":{"type":"string","description":"~idofthefirstoperationinchain"},"ref":{"$ref":"#/definitions/OperationChainRef"},"auth":{"$ref":"#/definitions/OperationChainAuth"},"serviceType":{"type":"string","description":"businessserviceclassification"},"serviceDateTime":{"type":"string","format":"date-time","description":"billdatetime(primaryactiondatetime)"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["id","serviceType"]},"OperationChainRef":{"type":"object","additionalProperties":true,"description":"chainreferenceset","properties":{"authCode":{"type":"string"},"rrn":{"type":"string","description":"retrievalreferencenumber"},"tref":{"type":"string","description":"paymentschemereferencenumber"},"srn":{"type":"string","description":"systemreferencenumber"},"arn":{"type":"string","description":"acquirerreferencenumber"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}}},"OperationChainAuth":{"type":"object","additionalProperties":true,"description":"conditionswhentransactionhasbeenapproved","properties":{"conditions":{"type":"array","items":{"type":"string"},"description":"taglistfromtransattribute"},"isContactless":{"type":"boolean"},"isPinBased":{"type":"boolean"},"isRecurring":{"type":"boolean"},"isEcom":{"type":"boolean"},"is3DS":{"type":"boolean"},"tokenType":{"type":"string","description":"e.g.ApplePay,GooglePay..."},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["conditions"]},"IssuingCardRef":{"type":"object","additionalProperties":true,"description":"detailsoftheoperationpaymentinstrument","properties":{"id":{"type":"string"},"externalId":{"type":"string","description":"cardidentifierinbanksystem"},"pan":{"type":"string","description":"maskedornot"},"plastic":{"$ref":"#/definitions/CardPlastic"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["id","pan"]},"CardPlastic":{"type":"object","additionalProperties":true,"properties":{"expire":{"type":"string","description":"YYMM"},"seqvN":{"type":"string"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}}},"IssuingAccountRef":{"type":"object","additionalProperties":true,"properties":{"id":{"type":"string"},"iban":{"type":"string","description":"Internationalbankaccountnumber(IBAN)"},"bic":{"type":"string","description":"BankIdentifierCode(BIC)"},"accountNumber":{"type":"string","description":"AccountNumber"},"contractNumber":{"type":"string","description":"ContractNumber"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["id"]},"OperationAmount":{"type":"object","additionalProperties":true,"description":"amountssubmittedbyoperationinitiatorandpaymentschemeintransactionmessage","properties":{"paymentDirection":{"type":"string","enum":["Debit","Credit","None"],"description":"accountingdirectionregardingtooperationtarget"},"transaction":{"$ref":"#/definitions/Money"},"cashback":{"$ref":"#/definitions/Money"},"billing":{"$ref":"#/definitions/Money","description":"namedalsosettlement"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["paymentDirection"]},"Money":{"type":"object","additionalProperties":true,"properties":{"amount":{"type":"string"},"currency":{"type":"string"},"formatted":{"type":"string"}},"required":["amount","currency"]},"IncomingRouting":{"type":"object","additionalProperties":true,"properties":{"routingType":{"type":"string","enum":["Incoming"],"default":"Incoming"},"paymentScheme":{"type":"string","description":"paymentscheme'name'.e.g.:VISA,MC..."},"clearingDate":{"type":"string","format":"date","description":"intermofpaymentschemeclearingprocess"},"sourceMemberId":{"type":"string"},"receivingMemberId":{"type":"string"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"},"direction":{"type":"string","enum":["Incoming","Outgoing","Internal"]}},"title":"Incoming","required":["routingType","paymentScheme","sourceMemberId","receivingMemberId","direction"]},"OutgoingRouting":{"type":"object","additionalProperties":true,"properties":{"routingType":{"type":"string","enum":["Outgoing"],"default":"Outgoing"},"paymentScheme":{"type":"string","description":"paymentscheme'name'.e.g.:VISA,MC..."},"clearingDate":{"type":"string","format":"date","description":"intermofpaymentschemeclearingprocess"},"targetMemberId":{"type":"string"},"sendingBin":{"type":"string"},"sendingMemberId":{"type":"string"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"},"direction":{"type":"string","enum":["Incoming","Outgoing","Internal"]}},"title":"Outgoing","required":["routingType","paymentScheme","targetMemberId","sendingMemberId","direction"]},"OnUsRouting":{"type":"object","additionalProperties":true,"properties":{"routingType":{"type":"string","enum":["OnUs"],"default":"OnUs"},"direction":{"type":"string","enum":["Incoming","Outgoing","Internal"]},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"title":"OnUs","required":["routingType","direction"]},"InternalRouting":{"type":"object","additionalProperties":true,"properties":{"routingType":{"type":"string","enum":["Internal"],"default":"Internal"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"},"direction":{"type":"string","enum":["Incoming","Outgoing","Internal"]}},"title":"Internal","required":["routingType","direction"]},"PointOfService":{"type":"object","additionalProperties":true,"description":"forparticularoperation","properties":{"country":{"type":"string"},"city":{"type":"string"},"location":{"type":"string"},"merchantName":{"type":"string"},"mcc":{"type":"string"},"merchantId":{"type":"string"},"terminalId":{"type":"string"},"terminalType":{"type":"string","enum":["CAT","ATM","POS","WEB","IMPRINTER","ECOMMERCE","MPOS"],"description":"bytransattributes"},"institution":{"$ref":"#/definitions/FinancialInstitution"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}}},"FinancialInstitution":{"type":"object","additionalProperties":true,"description":"financialinstitutionidentification","properties":{"bank":{"type":"string"},"branch":{"type":"string"},"country":{"type":"string","description":"ISO3166Alfa(3)countrycode"},"office":{"type":"string"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}},"required":["bank","branch","country"]},"IssuingOperationProcessing":{"type":"object","additionalProperties":true,"description":"processingresults(issuingspecific)","properties":{"billingDate":{"type":"string","format":"date","description":"targetaccountstartofbilling"},"availableAmount":{"$ref":"#/definitions/Money","description":"paymentinstrumentavailableamountbeforetheoperation(on-uscardauthonly)"},"baseAmount":{"$ref":"#/definitions/Money","description":"totalbyentries:requestedamountinaccountcurrency"},"feeAmount":{"$ref":"#/definitions/Money","description":"totalbyentries:feeamountinaccountcurrency"},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"},"resolution":{"type":"string","enum":["Accepted","Rejected"]},"resultCode":{"type":"string"},"chainStage":{"type":"string","enum":["Authorized","Presented","Settled","Reversed","Disputed","Rejected"],"description":"serviceresultstageaftertheoperation"},"processedAt":{"type":"string","format":"date-time","description":"processingtime"},"effectiveDate":{"type":"string","format":"date","description":"intermsofbankdate"},"fxRateId":{"type":"string"}},"required":["resolution","resultCode","chainStage","processedAt","effectiveDate"]},"PaymentDetails":{"type":"object","additionalProperties":true,"description":"PartyInfo","properties":{"partyType":{"type":"string","enum":["Payer","Beneficiary"],"description":"Partytype"},"party":{"$ref":"#/definitions/PartyInfo","description":"Party"},"bank":{"$ref":"#/definitions/PartyInfo","description":"PartybankInfo"},"corrBank":{"$ref":"#/definitions/PartyInfo","description":"PartycorrespondentbankInfo"}}},"PartyInfo":{"type":"object","additionalProperties":true,"properties":{"name":{"type":"string","description":"Partyname"},"accountInfo":{"$ref":"#/definitions/PartyAccount"},"taxInfo":{"$ref":"#/definitions/PartyTax"},"taggedData":{"type":"object","additionalProperties":{"type":"string"}},"additionalData":{"type":"object","additionalProperties":{},"description":"additionalcustomdata"}}},"PartyAccount":{"type":"object","additionalProperties":true,"description":"Partyaccountattributes","properties":{"accountNumber":{"type":"string","description":"Accountnumber"},"accountMemberId":{"type":"string","description":"Accountmemberid"}}},"PartyTax":{"type":"object","additionalProperties":true,"description":"Partytaxattributes","properties":{"itn":{"type":"string","description":"Individualtaxnumber"},"taxPosition":{"type":"string","description":"Taxposition"}}}}}"""
  //
  //    val allProps = getAllProps()
  //    println("allProps: " + allProps)
  //    val commonKafkaProps = getPropsFromMap(allProps.filterKeys(key => !key.startsWith("app.")))
  //    println("commonKafkaProps: " + commonKafkaProps)
  //    val staticJsonSchema = KafkaUtils.getJsonSchema("streaming_json-schemas", commonKafkaProps, "issuing-operation-2.1",10)
  //
  //    assert(staticJsonSchema == standardJsonSchema)
  //  }
}
